<style>


    .contest_description{
        margin-bottom:35px;
    }
    .contest_form_div{
        margin-top:20px;
        width:75%;
        margin-left:80px;
    }
    
    .large_field{
        display:inline-block;
        width:49%;
    }
    .small_field {
        width:32.5%;
        display:inline-block;
    }
    
    .full_field input, .large_field input, .small_field input {
        width:98%;
    }
    
    @media (max-width: 767px) {
        .main{
            width:95%;
        }
        .large_field, .small_field {
            width:100%;
        }
        .contest_form_div{
            width:100%;
            margin-left:0;
        }
    }
</style>

<div id="loading_screen">
    <img alt="loading" src="//kodekloud.s3.amazonaws.com/sites/5447ebb66e6f641987020000/3604f5c26997bea3de504de139debcec/loading.gif"/>
</div>
<div  id="main_content" style="display:none">
    <ul class="breadcrumb">
        <li><a href="/home">Home</a> </li>
         <li class="active">Contest</li>
    </ul>
    <div class="page_banner">
       Enter to WIN a $250 Gift Card
    </div>
    
    <div class="inside_page_content">
        <img class="contest_image" src="//kodekloud.s3.amazonaws.com/sites/54e4c5846e6f640b1b000000/046fe35e3f30992aebd4274512fb63f4/Contest_858x500_Final.png" />
     <br>
     <div class="contest_form_div">
           <p class="contest_description">Complete the form below for your chance to WIN a $250 Gift Card to your favorite The Village at Vaughan Mills store! Contest closes May 31st, 2015. One entry per person. Winner will be contacted via email.</p>

         <form action="https://mobilefringe.createsend.com/t/d/s/tkhhlr/" method="post" id="contest_form">
           <p style="display:none">
                <label for="fieldName">Name</label><br />
                <input id="fieldName" name="cm-name" type="text"/>
            </p>
            
            <p class="large_field">
                <label for="firstName">First Name*</label><br/>
                <input id="firstName" type="text" required placeholder="First Name" />
            </p>
            <p class="large_field">
                <label for="lastName">Last Name*</label><br/>
                <input id="lastName" type="text" required placeholder="Last Name"/>
            </p>
          
            <p class="large_field">
                <label for="fieldEmail">Email*</label><br />
                <input id="fieldEmail" name="cm-tkhhlr-tkhhlr" type="email" required placeholder="Email"/>
            </p>
            <p class="large_field">
                <label for="fieldjrihki">Phone Number*</label><br />
                <input id="fieldjrihki" name="cm-f-jrihki" type="text" required placeholder="Phone Number"/>
            </p>
            <p class="full_field">
                <label for="fieldjrihkt">Street Address</label><br />
                <input id="fieldjrihkt" name="cm-f-jrihkt" type="text" placeholder="Street Address"/>
            </p>
            <p class="small_field">
                <label for="fieldjrihkd">City</label><br />
                <input id="fieldjrihkd" name="cm-f-jrihkd" type="text" placeholder="City"/>
            </p>
            
            <p class="small_field">
                <label for="fieldjrihkk">Postal Code*</label><br />
                <input id="fieldjrihkk" name="cm-f-jrihkk" type="text" required placeholder="Postal Code"/>
            </p>
            <p class="small_field">
                <label for="fieldjrihku">Year of Birth*</label><br />
                <input id="fieldjrihku" name="cm-f-jrihku" type="text" required placeholder= "Year of Birth"/>
            </p>
            <p style="display:none">
                <label for="fieldjrihkh">Contest ID</label><br />
                <input id="fieldjrihkh" name="cm-f-jrihkh" type="text" />
            </p>
            <br>
          
            
       
            <br>
                <label for="enterVerify">Enter the following number below to proceed: <div id="verifyNum"></div></label><br>
                <input type="hidden" value="701469" id="verifyNumHidden" name="verifyNumHidden" />
                <input type="text" id="enterVerify" name="enterVerify" />
            <br>
            <span>
            <br>
                <label for="newsletter_signup" style="display:none">Agree Terms</label>
              <input type="checkbox" class="info_check" id="newsletter_signup"/>&nbsp;Yes, I would like to receive ongoing news related to events, promotions and special announcements from The Village at Vaughan Mills.
            </span>
            <br>
            <br>
            <span>
                <label for="agree_terms" style="display:none">Agree Terms</label>
              <input type="checkbox" class="info_check" id="agree_terms" required/>&nbsp;I agree to the <a href = "/rules_regulations"><u>rules and regulations</u></a>. 
            </span>
            <br>
            <br>
            <p>
                <button class="btn btn-primary" type="submit">Submit</button>
            </p>
        </form>
     </div>
    </div>
</div>
<script>

    function randomgen() {
        var rannumber='';
        for(ranNum=1; ranNum<=6; ranNum++){
            rannumber+=Math.floor(Math.random()*10).toString();
        }
        $('#verifyNum').html(rannumber);
        $('#verifyNumHidden').val(rannumber);
    }
    randomgen();
  
    $('#contest_form').submit(function (e) {
        if($('#enterVerify').val() == $('#verifyNumHidden').val() ) {
            if ($("#agree_terms").prop("checked") == true){
                var e = verify_required_fields();
                if (e == true){
                    var name = $("#firstName").val() + " " + $("#lastName").val();
                    $('input[name="cm-name"]').attr('value',name);
                    var date = new Date;
                    contest_id = (get_month(date.getMonth())) + date.getFullYear();
                    $('input[name="cm-f-jrihkh"]').attr('value',contest_id);
                    if ($("#newsletter_signup").prop("checked") == true){
                        var s = check_email();
                        if (s == true){
                            var email = $("#fieldEmail").val();
                            $('input[name="cm-tktdtj-tktdtj"]').attr('value',email);
                            console.log($("#subForm").serialize())
                             $.getJSON(
                                "https://mobilefringe.createsend.com/t/d/s/tktdtj/?callback=?",
                               $("#subForm").serialize(),
                                function (data) {
                                    if (data.Status === 400) {
                                        e.preventDefault();
                                        alert("Please try again later.");
                                    } else { // 200
                                        // $('#contest_form').unbind('submit').submit();
                                    }
                            });  
                        } else {
                            e.preventDefault();
                            alert("Invaid E-mail address.")
                        }
                        
                    } else {
                        $('#contest_form').unbind('submit').submit();    
                    }    
                } else {
                    e.preventDefault();
                    alert("One or more required fields are blank! please fill in all fields marked with * and try again.")
                }
                
                
            } else {
                e.preventDefault();
                alert("Please agree to the terms and conditions before submitting!")
            }
        }
            else
            {
                alert("Please Enter Correct Verification Number");
                randomgen();
                e.preventDefault();
            }
        
    });
    
    
    function verify_required_fields (){
        if ($("#firstName").val() != "" && $("#lastName").val() != "" && $("#fieldEmail").val() != "" && $("#fieldjrihki").val() != "" && $("#fieldjrihkk").val() != "" && $("#fieldjrihku").val() != "") {
            return true;
        } else {
            return false;
        }
    }
    
    function check_email (){
        var email = $("#fieldEmail").val();
        if( !validateEmail(email)) {
            return false
        } else {
            return true
        }
    }
    
    function validateEmail($email) {
      var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
      if( !emailReg.test( $email ) ) {
        return false;
      } else {
        return true;
      }
    }
    
    function get_month (id){
        switch(id) {
            case 0:
                month = "Jan"
                break;
            case 1:
                month = "Feb"
                break;
            case 2:
                month = "Mar"
                break;
            case 3:
                month = "Apr"
                break;
            case 4:
                month = "May"
                break;
            case 5:
                month = "June"
                break;
            case 6:
                month = "July"
                break;
            case 7:
                month = "Aug"
                break;
            case 8:
                month = "Sep"
                break;
            case 9:
                month = "Oct"
                break;
            case 10:
                month = "Nov"
                break;
            case 11:
                month = "Dec"
                break;
                
        }
        return month;
    }


    $(document).ready(function() {
        function renderAll (){
            var propertyDetails = getPropertyDetails();
            renderPageData('#centre_info_container','#centre_info_template',propertyDetails, 'property_details')
            $("#loading_screen").hide();
            $("#main_content").show();
        }
        
    
        function renderPageData(container, template, collection, type){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(template_html);   // optional, speeds up future uses
            if (type == "property_details"){
                item_list.push(collection);
                collection = []
                collection = item_list;
            }
            $.each( collection , function( key, val ) {
                var rendered = Mustache.render(template_html,val);
                item_rendered.push(rendered);
    
            });
            
            $(container).show();
            $(container).html(item_rendered.join(''));
        };

        loadMallData(renderAll);  

    
  
    });
    
</script>